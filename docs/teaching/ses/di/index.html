<!DOCTYPE html>
<html lang="en-us">
    <head>
        <link rel="stylesheet" href="https://brainbaking.com/css/brainbaking.css">



	<meta name="description" content="Labo x: Design Patterns: Dependency Injection - Brain Baking">
	<meta content="Labo x: Design Patterns: Dependency Injection - Brain Baking" property="og:title">
	<meta content="Labo x: Design Patterns: Dependency Injection - Brain Baking" property="og:description">




<meta property="og:url" content="https://brainbaking.com/teaching/ses/di/" />
<meta property="og:type" content="website" />





<meta property="article:published_time" content="0001-01-01 00:00:00 &#43;0000 UTC" />
<meta property="article:modified_time" content="0001-01-01 00:00:00 &#43;0000 UTC" />
<meta property="article:section" content="teaching" />




<script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/brainbaking.com\/"
    },
    "articleSection" : "teaching",
    "name" : "Labo x: Design Patterns: Dependency Injection",
    
      "headline" : "Labo x: Design Patterns: Dependency Injection",
    
    "description" : "\x26laquo;\x26nbsp;Terug naar Software Engineering Skills \x26raquo;\x26nbsp;Naar de labo opgave\n\x26ldquo;Dependency Injection (DI)\x26rdquo; - Design Pattern Doelstelling  Promoot modulariteit door afhankelijkheden te injecteren, zodat aparte modules eenvoudig inplugbaar zijn in andere productiecode. Op deze manier worden modules ook makkelijker tesbaar. Promoot Inversion of Control: een client die services aanroept zou niet mogen weten hoe services worden aangemaakt - deze zou moeten worden \x26lsquo;geinjecteerd\x26rsquo;.  Wikipedia: Dependency Injection\nVoorbeeld 1. Opzet Als we verder gaan op het voorbeeld van de singleton, zien we dat een database handle nodig is om shopping cart gegevens op te halen.",
    
      "inLanguage" : "nl-BE",
    
    
      "image": "https:\/\/brainbaking.com\/img/avatar-icon.png",
    
    "author" : {
    	"@type": "Person",
    	"name": "Wouter Groeneveld"
	  },
    "publisher": {
    	"@type": "Organization",
    	"name": "Brain Baking",
    	"logo": {
    		"@type": "ImageObject",
    		"url": "https:\/\/brainbaking.com\/img/avatar-icon.png"
    	}
	  },
    "accountablePerson" : "Wouter Groeneveld",
    "copyrightHolder" : "Wouter Groeneveld",
    "copyrightYear" : "0001",
    "datePublished": "2019-12-07 10:03:48 \x2b0100 CET",
    "dateModified" : "2019-12-07 10:03:48 \x2b0100 CET",
    "url" : "https:\/\/brainbaking.com\/teaching\/ses\/di\/",
    "wordCount" : "785",
    "keywords" : [ "Labo x: Design Patterns: Dependency Injection", "teaching" ]
}
</script>



<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-45748221-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Labo x: Design Patterns: Dependency Injection</title>
        
        <style>

    html body {
        font-family: 'Source Serif Pro', sans-serif;
        background-color: white;
    }

    :root {
    	--accent: #008eb3;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://brainbaking.com/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source%20Serif%20Pro">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/paraiso-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cs.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cpp.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scheme.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/llvm.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.59.1" />
        
    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Labo x: Design Patterns: Dependency Injection</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/post"><i class='fa fa-file-code-o'></i>&nbsp;Tech Blog</a></li>
                            
                                <li><a href="/essays"><i class='fa fa-book'></i>&nbsp;Essays</a></li>
                            
                                <li><a href="/tags"><i class='fa fa-tags'></i>&nbsp;Tags</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li><a href="/about"><i class='fa fa-user'></i>&nbsp;About Me</a></li>
                            
                                <li><a href="/teaching"><i class='fa fa-graduation-cap'></i>&nbsp;Teaching</a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>




<main>

    <a name="top"></a>
    <div class="item">

    
    <h3>
        
        <a href="/teaching/ses/di/">Labo x: Design Patterns: Dependency Injection</a>
    </h3>
    

    
    
    


    
    

</div>


    <br> <div class="text-justify">

<p>&laquo;&nbsp;<a href="/teaching/ses">Terug naar Software Engineering Skills</a><br/>
&raquo;&nbsp;<a href="#oef">Naar de labo opgave</a></p>

<h2 id="dependency-injection-di-design-pattern"><em>&ldquo;Dependency Injection (DI)&rdquo;</em> - Design Pattern</h2>

<h3 id="doelstelling">Doelstelling</h3>

<ul>
<li>Promoot <em>modulariteit</em> door afhankelijkheden te injecteren, zodat aparte modules eenvoudig inplugbaar zijn in andere productiecode. Op deze manier worden modules ook makkelijker tesbaar.</li>
<li>Promoot <em>Inversion of Control</em>: een client die services aanroept zou niet mogen weten hoe services worden aangemaakt - deze zou moeten worden &lsquo;geinjecteerd&rsquo;.</li>
</ul>

<p><a href="https://en.wikipedia.org/wiki/Dependency_injection">Wikipedia: Dependency Injection</a></p>

<h3 id="voorbeeld">Voorbeeld</h3>

<h4 id="1-opzet">1. Opzet</h4>

<p>Als we verder gaan op het voorbeeld van de <a href="/teaching/ses/singleton">singleton</a>, zien we dat een database handle nodig is om shopping cart gegevens op te halen. Hoe deze database wordt aangemaakt, daar heeft een typische API geen kaas van gegeten: daar komt meestal een connection string bij kijken met gebruikersnaam, wachtwoord, en IP adres naar de juiste DB server.</p>

<p>De DB accessor:</p>

<pre><code class="language-java">public class DBHandle {
    private String connectionString;

    // comes from some config file
    public DBHandle(String connectionString) {
        this.connectionString = connectionString;
    }

    public ShoppingCart getShoppingCart() {
        // SELECT * FROM ...
    }
}
</code></pre>

<p>Met als REST endpoint:</p>

<pre><code class="language-java">@Path(&quot;/shoppingcart&quot;)
public class ShoppingResource {
    @GET
    public ShoppingCart getCart() {
        String conStr = ConfigurationManager.getConfig('dbconnection');
        return new DBHandle(conStr).getShoppingCart();
    }
}
</code></pre>

<h4 id="2-probleemstelling">2. Probleemstelling</h4>

<p>Elke Resource klasse die een <code>DBHandle</code> instance wenst, zal ook via de <code>ConfigurationManager</code> het constructor argument moeten ophalen, om een instantie te kunnen aanmaken. Dit is uiteraard <strong>niet</strong> de juiste manier en introduceert veel duplicatie. Nu is de shopping resource &ldquo;in control&rdquo;, terwijl we in dat geval de Database de controle willen geven: <strong>Inversion of Control</strong> dus.</p>

<h4 id="3-oplossing">3. Oplossing</h4>

<p>Een mogelijke oplossing is een Singleton maken. Maar dan hebben we nog steeds:</p>

<pre><code class="language-java">@Path(&quot;/shoppingcart&quot;)
public class ShoppingResource {
    @GET
    public ShoppingCart getCart() {
        return DBHandle.getInstance().getShoppingCart();
    }
}
</code></pre>

<p>Als we deze methode willen testen, door <code>getCart()</code> op te roepen, spreken we steeds de échte database aan, wat duidelijk niet het gewenste gedrag is. We willen in dat geval de database <strong>injecteren</strong>. Een tweede stap is om de implementatie te verbergen achter een interface.</p>

<pre><code class="language-java">@Path(&quot;/shoppingcart&quot;)
public class ShoppingResource {
    private final DBHandle dbHandle;

    public ShoppingResource(DBHandle handle) {
        this.dbHandle = handle;
    }

    @GET
    public ShoppingCart getCart() {
        return dbHandle.getShoppingCart();
    }
}
</code></pre>

<p>Nu weet deze klasse niet meer hoe hij de database aanmaakt: hij krijgt dit slechts toegeschoven via de constructor. Uiteraard hebben we het probleem verlegt: wie maakt deze resource klasse aan? Om dit probleem op te lossen zijn er typische Dependency Injection frameworks beschikbaar die objecten in een pool aanmaken en zo injecteren. Voorbeelden hiervan zijn:</p>

<ul>
<li><a href="https://github.com/google/guice">Google Guice</a></li>
<li><a href="https://spring.io">Spring Framework</a></li>
</ul>

<p>Als <code>DBHandle</code> een interface is, kunnen we op een eenvoudige manier een dummy implementatie maken en dit injecteren in de klasse ter test:</p>

<pre><code class="language-java">public class DummyDBHandle implements DBHandle {
    public boolean called;
    @Override
    public ShoppingCart getShoppingCart() {
        called = true;
        return null;
    }
}

public class ShoppingResourceTest {
    @Test
    public void getCart_callsGetShoppingCartFromDb() {
        DummyDBHandle dbHandle = new DummyDBHandle();
        ShoppingResource resource = new ShoppingResource(dbHandle);
        resource.getCart();

        assertThat(dbHandle.called, is(true));
    }
}
</code></pre>

<p>Merk op dat de <code>connectionString</code> van de <code>DBHandle</code> ook via de constructor als argument wordt doorgegeven: dit is evenzeer een vorm van Dependency Injection.</p>

<h3 id="eigenschappen-van-dit-patroon">Eigenschappen van dit patroon</h3>

<ul>
<li>Geef de verantwoordelijkheid van het <em>aanmaken</em> van een object af. Een instantie wordt geinjecteerd door middel van een constructor of setter.</li>
<li>Maak van objecten geïsoleerde(re) stukjes code die makkelijker testbaar zijn dan hard gekoppelde objecten.</li>
</ul>

<h2 id="a-name-oef-a-labo-oefeningen"><a name="oef"></a>Labo oefeningen</h2>

<p>Via <a href="/teaching/ses/github-classroom"><i class='fa fa-github'></i> Github Classroom</a>.</p>

<h3 id="opgave-1">Opgave 1</h3>

<ul>
<li>Er staan twee TODO items: verwijder eerst de <code>new DBHandle()</code> vanuit de resource klasse, en injecteer het via een constructor argument. Pas dan de unit test aan om de compile fouten te fixen.</li>
<li>Gebruik een interface om bovenstaande <code>DummyDBHandle</code> in het project te introduceren. Dat wil zeggen, hernoem <code>DBHandle</code> naar <code>DBHandleImplementation</code>, en maak een nieuwe interface genaamd <code>DBHandle</code>. Nu kan je de tweede unit test zoals hierboven toevoegen.</li>
</ul>

<h3 id="opgave-2">Opgave 2</h3>

<p>In plaats van manueel te injecteren, kunnen we deze zaken ook overlaten aan gespecialiseerde frameworks, zoals Google Guice. Bovenstaand project heeft als Gradle dependency een link naar Guice. Neem een kijkje in de <code>ShoppingCartGuiceResource</code> klasse, en probeer dit principe toe te passen op de andere resouce klasse. <code>@Inject</code> verzogt het DI systeem, zonder zelf ergens objecten aan te maken, behalve in de config klasse.</p>

<p>Zie ook <a href="https://github.com/google/guice/wiki/GettingStarted">Google Guice: getting started</a>.</p>

<h3 id="opgave-3">Opgave 3</h3>

<p><a href="/teaching/ses/sessy">sessy library</a>:</p>

<ol>
<li>identificeer welke klassen in een DI systeem kunnen worden opgenomen.</li>
<li>Introduceer een DI systeem: hetzij door Google Guice te gebruiken, hetzij door zelf te injecteren. Waar wordt DI reeds toegepast?</li>
</ol>

<h2 id="denkvragen">Denkvragen</h2>

<ul>
<li>Dependency Injection kan via de constructor, via setters (of direct op het veld via reflectie). Wat zijn de voor- en nadelen van via de constructor te werken, ten opzichte van via setters?</li>
<li>Denk je dat de <code>GuiceConfigModule</code> klasse op termijn niet te groot en verwarrend wordt, als dit constant wordt uitgebreid met nieuwe instanties die geregistreerd worden bij Guice? Wat zou je dan doen om dit tegen te gaan?</li>
</ul>
</div>

    
    

    

    <h4 class="page-header">&nbsp;</h4>

    <i class='fa fa-arrow-circle-o-up'></i>&nbsp;<a href="#top">Top</a> 

</main>

        <footer>

            <p class="copyright text-muted">No <i class='fa fa-copyright'></i> reserved - sharing is caring. <i class='fa fa-github'></i> <a href='https://github.com/wgroeneveld/brainbaking/'>Hack away</a>! <i class='fa fa-lightbulb-o'></i> <a href='/'>Brain Baking</a></p>

        </footer>
       
    </body>

</html>

