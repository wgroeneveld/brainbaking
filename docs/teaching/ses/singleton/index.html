<!DOCTYPE html>
<html lang="en-us">
    <head>
        <link rel="stylesheet" href="https://brainbaking.com/css/brainbaking.css">



	<meta name="description" content="Design Patterns: Singleton - Brain Baking">
	<meta content="Design Patterns: Singleton - Brain Baking" property="og:title">
	<meta content="Design Patterns: Singleton - Brain Baking" property="og:description">




<meta property="og:url" content="https://brainbaking.com/teaching/ses/singleton/" />
<meta property="og:type" content="website" />





<meta property="article:published_time" content="0001-01-01 00:00:00 &#43;0000 UTC" />
<meta property="article:modified_time" content="0001-01-01 00:00:00 &#43;0000 UTC" />
<meta property="article:section" content="teaching" />




<script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/brainbaking.com\/"
    },
    "articleSection" : "teaching",
    "name" : "Design Patterns: Singleton",
    
      "headline" : "Design Patterns: Singleton",
    
    "description" : "\x26laquo;\x26nbsp;Terug naar Software Engineering Skills \x26raquo;\x26nbsp;Naar de labo opgave\n\x26ldquo;Singleton\x26rdquo; - Design Pattern Begeleidende screencast:\n  Doelstelling  Vermijd de mogelijkheid tot meervoudige instantiatie van een bepaalde klasse. Er kan altijd maar één bepaalde instantie van bestaan. Voorzie een eenvoudige manier om vanuit eender waar in de code toegang te verkrijgen tot die éne instantie. Encapsuleer logica om deze instantie aan te maken, moest code dit raadplegen en dit toevallig de eerste keer zijn (lazy initialization).",
    
      "inLanguage" : "nl-BE",
    
    
      "image": "https:\/\/brainbaking.com\/img/avatar-icon.png",
    
    "author" : {
    	"@type": "Person",
    	"name": "Wouter Groeneveld"
	  },
    "publisher": {
    	"@type": "Organization",
    	"name": "Brain Baking",
    	"logo": {
    		"@type": "ImageObject",
    		"url": "https:\/\/brainbaking.com\/img/avatar-icon.png"
    	}
	  },
    "accountablePerson" : "Wouter Groeneveld",
    "copyrightHolder" : "Wouter Groeneveld",
    "copyrightYear" : "0001",
    "datePublished": "2020-03-26 11:30:29 \x2b0100 CET",
    "dateModified" : "2020-03-26 11:30:29 \x2b0100 CET",
    "url" : "https:\/\/brainbaking.com\/teaching\/ses\/singleton\/",
    "wordCount" : "732",
    "keywords" : [ "Design Patterns: Singleton", "teaching" ]
}
</script>



<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-45748221-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Design Patterns: Singleton</title>
        
        <style>

    html body {
        font-family: 'Source Serif Pro', sans-serif;
        background-color: white;
    }

    :root {
    	--accent: #008eb3;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://brainbaking.com/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source%20Serif%20Pro">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/paraiso-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cs.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cpp.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scheme.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/llvm.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.59.1" />
        
    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Design Patterns: Singleton</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/post"><i class='fa fa-file-code-o'></i>&nbsp;Tech Blog</a></li>
                            
                                <li><a href="/essays"><i class='fa fa-book'></i>&nbsp;Essays</a></li>
                            
                                <li><a href="/tags"><i class='fa fa-tags'></i>&nbsp;Tags</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li><a href="/about"><i class='fa fa-user'></i>&nbsp;About Me</a></li>
                            
                                <li><a href="/teaching"><i class='fa fa-graduation-cap'></i>&nbsp;Teaching</a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>




<main>

    <a name="top"></a>
    <div class="item">

    
    <h3>
        
        <a href="/teaching/ses/singleton/">Design Patterns: Singleton</a>
    </h3>
    

    
    
    


    
    

</div>


    <br> <div class="text-justify">

<p>&laquo;&nbsp;<a href="/teaching/ses">Terug naar Software Engineering Skills</a><br/>
&raquo;&nbsp;<a href="#oef">Naar de labo opgave</a></p>

<h2 id="singleton-design-pattern"><em>&ldquo;Singleton&rdquo;</em> - Design Pattern</h2>

<p>Begeleidende screencast:</p>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://player.vimeo.com/video/398534668" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
 </div>


<h3 id="doelstelling">Doelstelling</h3>

<ul>
<li>Vermijd de mogelijkheid tot meervoudige instantiatie van een bepaalde klasse. Er kan altijd maar één bepaalde instantie van bestaan.</li>
<li>Voorzie een eenvoudige manier om vanuit eender waar in de code toegang te verkrijgen tot die éne instantie.</li>
<li>Encapsuleer logica om deze instantie aan te maken, moest code dit raadplegen en dit toevallig de eerste keer zijn (<em>lazy initialization</em>).</li>
</ul>

<p><a href="https://sourcemaking.com/design_patterns/singleton">Dive Into Design Patterns: Singleton</a></p>

<h3 id="voorbeeld">Voorbeeld</h3>

<h4 id="1-opzet">1. Opzet</h4>

<p>Een klassiek voorbeeld van een Singleton patroon is een database connectie, omdat het beheren van diezelfde connecties door diezelfde klasse gebeurt. Stel dat we een website hebben gemaakt met een winkelwagentje.</p>

<pre><code class="language-java">public class ShoppingCart {
    private int amountOfItems; // and getters/setters
    private int totalMOney;    // ...
}
</code></pre>

<p>En de DB accessor:</p>

<pre><code class="language-java">public class DBHandle {
    public ShoppingCart getShoppingCart() {
        // SELECT * FROM ...
    }
}
</code></pre>

<p>Met als REST endpoint:</p>

<pre><code class="language-java">@Path(&quot;/shoppingcart&quot;)
public class ShoppingResource {
    @GET
    public ShoppingCart getCart() {
        return new DBHandle().getShoppingCart();    // oops!
    }
}
</code></pre>

<h4 id="2-probleemstelling">2. Probleemstelling</h4>

<p>Tien gebruikers die op de site terecht komen wensen allemaal hun winkelwagentje te raadplegen. Er zijn maar twee DB connecties beschikbaar, dit opgelegd door de database zelf. Iemand moet die dus beheren (locken, vrijgeven, locken, &hellip; - dit heet <em>database pooling</em>).</p>

<p>Als we twee instanties van <code>DBHandle</code> maken, kunnen er plots 2x2 connecties open worden gemaakt naar de database. Die zal dit ook blokkeren, wat resulteert in 2 klanten die een crash ervaren, en twee die hun winkelwagen kunnen raadplegen zonder verdere problemen.</p>

<link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script defer src="/mermaid/mermaid.min.js">
	mermaid.initialize({
		startOnLoad: true,
		flowchart: {
			useMaxWidth: true
		}
	});
</script>
<div class="mermaid" align="center" >
	
graph TD;
    A[ShoppingResource Inst1]
    B[ShoppingResource Inst2]
    C[DBHandle Inst1]
    D[DBHandle Inst2]
    A -->|nieuwe instance| C
    B -->|nieuwe instance| D

</div>

<p>De <code>getCart()</code> methode mag dus in geen geval telkens een nieuwe <code>DBHandle</code> aanmaken.</p>

<h4 id="3-oplossing">3. Oplossing</h4>

<p>We hebben in dit geval een <em>singleton</em> instance nodig:</p>

<pre><code class="language-java">@Path(&quot;/shoppingcart&quot;)
public class ShoppingResource {
    @GET
    public ShoppingCart getCart() {
        return DBHandle.getInstance().getShoppingCart();
    }
}
</code></pre>

<p>Waarbij de klasse <code>DBHandle</code> wordt uitgebreid tot:</p>

<pre><code class="language-java">public class DBHandle {
    private static DBHandle instance;

    public static DBHandle getInstance() {
        if(instance == null) {
            instance = new DBHandle();
        }
        return instance;
    }

    private DBHandle() {
    }

    public ShoppingCart getShoppingCart() {
        // SELECT * FROM ...
    }
}
</code></pre>

<link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script defer src="/mermaid/mermaid.min.js">
	mermaid.initialize({
		startOnLoad: true,
		flowchart: {
			useMaxWidth: true
		}
	});
</script>
<div class="mermaid" align="center" >
	
graph TD;
    A[ShoppingResource Inst1]
    B[ShoppingResource Inst2]
    C[DBHandle Inst]
    A -->|zelfde instance| C
    B -->|zelfde instance| C

</div>

<p>Op die manier is het aanmaken van een <code>DBHandle</code> instance beperkt tot de klasse zelf, door de <code>private</code> constructor. In de statische methode wordt er eerst gecontroleerd of de instantie <code>null</code> is of niet. In principe zou er maar één keer tijdens de uitvoering van het programma de <code>new DBHandle()</code> regel worden uitgevoerd<sup class="footnote-ref" id="fnref:conc"><a href="#fn:conc">1</a></sup>.</p>

<h3 id="eigenschappen-van-dit-patroon">Eigenschappen van dit patroon</h3>

<ul>
<li>Definiëer de enige instantie als een ontoegankelijke <code>static</code> variabele, die door één enkele <code>public static</code> methode wordt bewaakt.</li>
<li>Singleton klassen hebben enkel een <code>private</code> constructor om te voorkomen dat dit nog elders kan worden aangemaakt.</li>
<li>Er wordt meestal een <code>null</code> check gedaan, zodat de code die de getter aanroept dit niet opnieuw moet doen. Dit voorkomt onnodige duplicatie op verschillende plaatsen in de codebase.</li>
</ul>

<h2 id="a-name-oef-a-labo-oefeningen"><a name="oef"></a>Labo oefeningen</h2>

<p>Via <a href="/teaching/ses/github-classroom"><i class='fa fa-github'></i> Github Classroom</a>.</p>

<h3 id="opgave-1">Opgave 1</h3>

<p>Hierin is bovenstaande voorbeeld verwerkt, maar nog zonder Singleton&hellip; Voer de unit testen uit in <code>src/main/test</code>: het resultaat zijn gefaalde testen (ROOD), omdat <code>DBHandle</code> verschillende keren wordt aangemaakt. Zorg er voor dat alle testen slagen (GROEN) door het singleton patroon te implementeren!</p>

<h3 id="opgave-2">Opgave 2</h3>

<p>Pas ook <code>ShoppingCartResource</code> aan naar een singleton. Is dat nodig om de database niet te overbelasten, als de andere klasse reeds een singleton is, of niet?</p>

<h3 id="opgave-3">Opgave 3</h3>

<p><a href="/teaching/ses/sessy">sessy library</a>:</p>

<ol>
<li>identificeer welke klassen een kans maken om een Singleton te worden. Denk aan bovenstaande voorbeeld. Is er reeds ergens een Singleton patroon geïmplementeerd?</li>
<li>Pas het patroon toe waar jij denkt dat het nodig is.</li>
<li>Hoe kan je afleiden welke gebruikte frameworks op bepaalde plekken Singleton klasses hebben?</li>
</ol>

<h2 id="denkvragen">Denkvragen</h2>

<ul>
<li>Dit patroon klinkt aanlokkelijk: eenvoudig, lost problemen op, dus waarom niet overal toepassen. Denk eens na over de verantwoordelijkheden van objecten. Waarom zou je zo veel mogelijk moeten <strong>vermijden</strong> om dit patroon toe te passen? Wie mag wel <code>DBHandle.getInstance()</code> aanroepen, en wie niet?</li>
<li>Wat gebeurt er als 10 mensen tegelijkertijd de eerste keer de <code>getInstance()</code> methode aanroepen? Hoe kunnen we dit oplossen?</li>
</ul>
<div class="footnotes">

<hr />

<ol>
<li id="fn:conc">Dit klopt niet helemaal als we kijken naar concurrency problemen, waarbij twee gebruikers op exact hetzelfde tijdstip de methode aanroepen. Dit laten we buiten beschouwing voor dit vak.
 <a class="footnote-return" href="#fnref:conc"><sup>[return]</sup></a></li>
</ol>
</div>
</div>

    
    

    

    <h4 class="page-header">&nbsp;</h4>

    <i class='fa fa-arrow-circle-o-up'></i>&nbsp;<a href="#top">Top</a> 

</main>

        <footer>

            <p class="copyright text-muted">No <i class='fa fa-copyright'></i> reserved - sharing is caring. <i class='fa fa-github'></i> <a href='https://github.com/wgroeneveld/brainbaking/'>Hack away</a>! <i class='fa fa-lightbulb-o'></i> <a href='/'>Brain Baking</a></p>

        </footer>
       
    </body>

</html>

