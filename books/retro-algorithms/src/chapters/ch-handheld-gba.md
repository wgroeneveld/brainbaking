
## The Game Boy Advance Family

\cover{gbaconsole.jpg}{Nintendo}{2001}{Handheld game console}

Jumping from the fourth generation of video game consoles directly to the sixth, Nintendo indeed introduced an _advanced_ portable model to the gaming market with the release of the Game Boy Advance (codenamed Advanced Game Boy or `AGB`) in March 2001. Equipped with a modernized 32-bit ARM CPU running at twice the speed of the Game Boy Color, this small device was more than capable of playing SNES-like games - still at the price of only two AA batteries. 

By the year 2001, Nintendo would have complete control over the handheld gaming market. It would take three more years before Sony decided to take a cut with their PlayStation Portable, mainly intended to compete with the Nintendo DS, a seventh generation video game console.

The third major Game Boy revision indeed again proved to be a smashing hit, breaking various sales records during its relatively short lifespan. In the United Kingdom, the GBA sold four times as much units in its first first week of release as the PlayStation 2[^gbasales]. Although Gunpei Yoko's "_Lateral Thinking with Withered Technology_" design philosophy was still applied (the system was still cheap: priced at `$99.99`[^gbapr]), it was clear that the technical specifications of the GBA were put into the spotlight. Why else would you name something "_Advance_" or put "_32 bit_" on the box? It almost feels like a poor apology: "We're really sorry about the Game Boy Color. This time, the model is really advanced, we promise!"

[^gbasales]: Source: [http://www.eurogamer.net/articles/article_30834](http://www.eurogamer.net/articles/article_30834).

[^gbapr]: About `$146.37` in 2020.

It becomes even more obvious when looking at a selection of the system's launch titles that liked to brag about the capabilities of the new Game Boy model: 

- _Castlevania: Circle of the Moon_. Phenomenal music, a huge castle to explore, and nimble Vampire Killing moves that were not even seen in Castlevania IV for the SNES. 
- _Super Mario Advance_. Don't dismiss this as a bleak adaptation of _Super Mario Bros. 2_ (which, in turn, is an adaptation of _Doki Doki Panic_): Nintendo R&D2 put a lot of effort in embedding rotating, popping, whooshing, bouncing, and stretching animations. The message is clear: "Dear game devs, look at this! The GBA has hardware-acceleration for this! Now go make games for it!"
- _F-Zero: Maximum Velocity_. A handheld that can do Mode-7 tricks such as rotating, scaling, and skewing background layers? Finally! No more archaic HDMA tricks are required to master. 

\marginfig{ch-handheld-gba/castlevaniadark.png}{Castlevania: Circle of the Moon played indoors on a cloudy day (simulated). You better mash that attack button since the background and foreground are barely distinguishable...}{Castlevania: Circle of the Moon on the GBA.}

\marginfig{ch-handheld-gba/castlevania.png}{Castlevania: Circle of the Moon running in the mGBA emulator. With the ample contrast from a PC screen, the Skeleton Bomber on the right stands out.}{Castlevania: Circle of the Moon.}

Next to showcasing the GBA's strengths, the games also showed its biggest weakness: there was still no backlit screen. This became especially painful for Castlevania fans like me: the grim setting did not exactly benefit from highly contrasting colors like the more cheerful Super Mario Advance did. Without a proper light source, this often resulted in a dark gooey mess that made an already punishing difficulty even more frustrating. Complaints about the contrast even made Konami go all out on the colors for their the next GBA Castlevania game, _Harmony of Dissonance_, that was criticized for... it's too bright color palette. 

This problem was not new, but made even more pressing since, compared to its predecessor, the palette size dramatically increased and the picture resolution was boosted by 66%. These features delivered sharp pictures with little motion blur - as long as you could see what you were doing. Circle of the Moon did age beautifully, provided you play it on a more modern system that enables you to see the eminent dangers in the castle corridors. 

Instead of only attracting newcomers to the handheld gaming scene, engineers at Nintendo made sure to keep their regular customers happy as well by shipping the hardware with a second CPU: the well-known Sharp LR35902. This enabled GBA machines to play GB and GBC games with little compromises. Since the GBA screen is horizontally-oriented and the original Game Boy was not, players are given the option to either play at the intended aspect ratio or to stretch the image to fill the GBA's screen by pressing \circled{L} or \circled{R}. Both options come at a cost: either the actual image size is smaller than the original handheld, or the image is blurry. 

Backwards compatibility was, and still is, a huge selling point. In the fall of 2001, home console players would be left in the cold as Nintendo finally switched from cartridge-based games on the N64 to mini-DVDs on the GameCube. Fortunately, Nintendo handheld consoles were consistently developed with compatibility in mind: the GBC plays GB games, the GBA plays GB and GBC games, the Nintendo DS plays GBA games, and the Nintendo 3DS plays DS games[^3dsemu]. 

[^3dsemu]: In addition, the Nintendo 3DS eShop sold various older handheld games. And yes, the Goomba Color emulator technically allows you to play GB/GBC games on your DS using a GBA flash cart. 

Inspecting the lifespan of the Nintendo handhelds yields a few interesting facts. The clever decision to engineer revisions of the original hardware significantly prolonged the lifespan of the Game Boy, by then already going strong for seven years. The frequent hardware revision strategy became common for all Nintendo handhelds. 

\begin{figure*}[h!]
    \centering
    \includegraphics{ch-handheld-gba/timeline.png}
    \caption[Console release timelines]{The lifespan of Nintendo handhelds and consoles. First group (lightgreen): the Game Boy family. Second group (darkgreen): the Game Boy Advance family. Consoles are marked in orange. The Nintendo 3DS (not pictured), part of the eighth generation, saw the light in 2011.}
\end{figure*}

The Game Boy Advance was only two years old when it got it's first revision, the SP - that's a lot quicker than the seven year gap between the original and the Pocket. That faster cadence was maintained when looking at the Nintendo DS and 3DS. However, the total lifespan of the GBA - apart from the eccentric GB Micro - was much shorter than the GB family: the GBA came in 2001 and went in 2004 as the DS was released. 

And yet, Nintendo did not at all drop support for the GBA. Then why would a company release another handheld that poses a threat to its own product? An IGN press report from November 2003 sheds some light on this[^ign03]:

[^ign03]: Source: [https://www.ign.com/articles/2003/11/14/nintendo-going-back-to-the-basics](https://www.ign.com/articles/2003/11/14/nintendo-going-back-to-the-basics).

> Early Thursday morning Nintendo confirmed that it had posted a loss for the beginning half of the fiscal year, the first time ever in the company's history. It also said it would develop a new game product which would not be the successor to GameCube or Game Boy Advance for release in 2004, but no further details were specified.

The company was struggling to keep up in the console race, with Sony's PlayStation stealing N64's thunder and Microsoft entering the market with the Xbox in 2001. As the sales chart on page \pageref{sales} shows, the GameCube was doing pretty bad compared to the PS2. Nintendo initially did not intend the Nintendo DS to succeed the Game Boy Advance, although in the end, it of course did. Instead, they were looking for something in-between a console and classic gaming handheld, something that would appeal to a much broader audience than just gamers. A slew of successful non-gamer friendly software titles such as _Dr. Kawashima's Brain Training_ and _Nintendogs_ did just that. 

Ultimately, the Nintendo DS family sold almost twice as much as the Game Boy Advance family. The huge success of the DS launch did not stop Nintendo from releasing another revision for the GBA, though: the tiny[^gbm] Game Boy Micro. According to the then Vice President George Harrison, the Game Boy line was Nintendo's testbed where they continuously and intentionally aspired to invent instead of merely reiterate[^inventsrc].  

[^gbm]: With dimensions of only `50`×`101`×`17.2` mm and a weight of `80` g, _tiny_ is definitely the correct word to use. 

[^inventsrc]: Source: [https://www.gamespot.com/articles/qanda-nintendo-vice-president-george-harrison/1100-6126595/](https://www.gamespot.com/articles/qanda-nintendo-vice-president-george-harrison/1100-6126595/).

However, inventing does not necessarily mean commercial success. Indeed, according to financial reports in 2007, the Game Boy Micro was Nintendo's worst selling handheld ever, only clocking in about `2.5` million units. Then Nintendo President Satoru Iwata later admitted that the Nintendo DS may have kept the Micro from performing better sales-wise[^iwa]:

[^iwa]: Source: [https://www.nintendo.co.jp/kessan/060607qa_e/03.html](https://www.nintendo.co.jp/kessan/060607qa_e/03.html).

> The sales of Micro did not meet our expectations. Micro showed different sales in and outside Japan. In Japan, initial sales of Micro were rather good and it did become a rather hot topic. So, there was the possibility for this product to grow in Japan. However, toward the end of 2005, Nintendo had to focus almost all of our energies on the marketing of DS, which must have deprived the Micro of its momentum. This is why Micro couldn't meet our expectations in Japan. 

Project Atlantis, the fitting codename for a new Game Boy, was sunk in 1997 for the same reason: Nintendo feared a new model would get in the way of the original Game Boy that still had a firm grasp of the handheld market. Atlantis was designed to be a proper successor to the original Game Boy, supposedly equipped with a 32-bit processor and a color screen. Instead, Nintendo again showed its conservative side by prolonging the Game Boy lifespan with the Game Boy Color. The 32-bit CPU idea was preserved in the freezer until 2001. 

The overlapping lifespans of consoles compared to the handhelds is also worth looking at. When the Game Boy Color saw the light in 1998, the Nintendo 64 was already trying to prove itself as the SNES successor for two years. The lifespan of successive consoles and handhelds did shorten a little as the hardware engineering time decreased, eventually coinciding the lifespan of handhelds with consoles of the previous generation. 

Several NES games were ported to Game Boy Color[^portgbc], sometimes even boasting improved graphics (_Dragon Quest I/II_, _Super Mario Bros._). The GBA has jokingly be called "_a portable SNES_"[^portablesnes], and the Nintendo DS hardware made it possible to run a modified version of _Super Mario 64_ and _Diddy Kong Racing_ on it, before the 3DS brought the big guns with _The Legend of Zelda: Ocarina of Time 3D_ and even excellent ports of GameCube games such as _Luigi's Mansion_. 

[^portgbc]: You might be inclined to think the Game Boy Color is capable of handling SNES games after playing the Donkey Kong Country on it. In reality, the game was completely remade for the GBC hardware. The term _port_ is used rather loosely. 

[^portablesnes]: Of course it wasn't: the low resolution of the screen and the poor sound sampling rates made sure of that. 

\newpage

\begin{figure}[h!]
    \centering
    \includegraphics{ch-handheld-gba/hw-gba.jpg}
    \caption{The Game Boy Advance. As with the older Game Boy series, multiple colors were released. In fact, changing the face-places with unofficial but very unique ones is a very popular and quite easy modification nowadays. At least with this translucent version, you don't have to pry out the cartridge or turn on the machine to determine which game is inserted. The ability to stare at capacitors is a free plus!}
\end{figure}

\newpage

\begin{figure}[h!]
    \centering
    \includegraphics{ch-handheld-gba/pcb-gba.jpg}
    \caption{The Game Boy Advance PCB, revision \texttt{03}. There's surprisingly little to see here as most components, including the second CPU, are embedded into the CPU-AGB casing in the middle. The chip on the top right is the 256 KB WRAM. The crystal to the left of the CPU runs at 4.194 MHz, as indicated on top o it: that is the same speed as the original Game Boy. The effective CPU speed was doubled for GBC and quadrupled for GBA games! The last visible chip on the front of the PCB is the LCD regulator marked AGB-REG, at the far left. \newline The back of the motherboard showcases the amplifier on the lower left (AMP AGB), close to the volume potentiometer and the speaker. The messy ribbon connector and red wire is the result of my unprofessional attempt at replacing the stock screen with a backlit one. The new screen taps into the power supply of the GBA via that wire. \newline Since the CPU is located at the back of the PCB this time, no aluminum shield is required to separate it from the cartridge slot. However, great care is needed when reassembling the unit with a thicker custom screen that puts a fair amount of pressure on the CPU casing.}
\end{figure}

\newpage

Technically, the Game Boy Advance was about twice as fast as the Game Boy Color and had eight times that much memory:

| _Specification_ | _Value_                                         |
|-----------------|-------------------------------------------------|
| CPU             | 16.8 MHz 32-bit ARM7TDMI and Sharp co-processor |
| Memory          | 256 KB work WRAM, 128 KB video VRAM             |
| Cartridges      | up to 32 MB                                     |
| Screen          | 240 width x 160 height (3:2 aspect ratio)       |
| Colors          | 15-bit RGB                                      |
| Audio           | Two 8-bit Digital-to-Analog Converters (DAC), four legacy channels from the original GB  |
| Audio output    | Stereo     |

At first sight, these numbers look impressive compared to Nintendo's SNES that housed the slower 16-bit Ricoh 5A22 processor. As we will see in chapter TODO-x, both PPUs have similar capabilities, also including DMA and HDMA systems for speedy memory read/write cycles. However, perhaps the most noticeable difference is the lack of a proper audio subsystem. The two DAC components merely stream and convert bytes into analog audio waves (at a painfully low 8-bit resolution): mixing and applying effects had to be done in software, consuming precious CPU cycles. Nintendo hoped game developers partially relied on the Sharp co-processor to produce 8-bit sound effects, which in the end few games utilized efficiently. 

Another feature borrowed from the SNES was the addition of the shoulder buttons. The action buttons \circled{X} and \circled{Y} had to wait until the DS. Whether the GBA designers borrowed the horizontal handheld layout from Sega's Game Gear, we'll probably never know. The decision did make the system more comfortable to hold and play for longer periods. 

The screen of the Game Boy Color could already handle 15-bit RGB values but the small memory footprint of the hardware limited the color palette. The GBA, with its more comfortable memory size, increased the color range from 56 to 256 for the foreground and another 256 for the background. As we will see in chapter TODO-x, certain bitmap modes even enabled access to the full range of $2^{15}$ colors.

### The Game Boy Advance SP

Instead of waiting seven years to redesign the first Advanced model, The Game Boy Advance "SP" (codenamed `AGS`) was released only two years after the original GBA. The fairly new horizontal layout was promptly thrown out of the window in favor of a model that resembles the Game Boy Color, except that the clamshell design enabled you to fold it in half. A closed GBA SP, measuring only about `8.4` cm, was finally the ultimate pocketable gaming machine.

According to Nintendo, the redesign was issued to address two major complaints of the original design. First, it was supposedly uncomfortable to use, hence the new layout. In practice, most players complained that it was in fact the SP model that hurt their hands, locking fingers in a cramped position because of the new clamshell design. 

Second, the complaints about the contrast of the screen were finally taken into account. Well, not entirely. The first SP model (`AGS-001`) included an internal front-light that could be toggled on and off. It acts as a Game Boy with an embedded Light Boy accessory. The result was better than the first GBA, but still not great, as frontlit LCD screens tend to have washed out colors. Fortunately, the revised revision (`AGS-101`) finally included a proper backlit screen - although you had to wait another two years for that, and Europeans were disadvantaged again with the extremely limited availability. 

The GBA SP ended an era of hauling a slew of AA (or, in the case of the Pocket, AAA) batteries together with your favorite handheld system. An integrated rechargeable lithium-ion battery compartment was finally introduced, that, according to the official specifications, should keep you busy up to eighteen hours, provided the screen light is disabled. The comfort that was gained with the charging system was suddenly lost once you wanted to plug in your headphones: the headphone jack disappeared, in favor of an awkward adapter - to be bought separately, of course - that plugs into the same AC port as the power charger. Without even more adapters, it was impossible to use headphones and charge the system simultaneously. Take that, spare AA batteries. 

### The Game Boy Micro

In 2005, Nintendo brought back the horizontal layout by introducing the Game Boy Micro, codenamed `OXY`. It looks like the result of a how-small-can-we-possibly-go contest: measuring just `10` cm wide and `5` cm long, and weighing only `80` g, this petite Game Boy could even slip in the same pocket as your keys. Although you better not do that since the casing was metallic this time and thus scratches easily. Also, you run into the risk of fishing out your Micro instead of your car key since both are equally small. 

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.59\columnwidth]{ch-handheld-gba/gbscreensizes.png}
    \caption{A comparison of Game Boy screen sizes (actual size). Dimensions in millimeter. GBA aspect ratios are \texttt{3:2} (in purple), while GB aspect ratios are approximately \texttt{10:9} (in orange for GBC, in gray for Pocket and Classic).}
\end{figure}

Roughly one third of the screen size disappeared. However, the reduced size did deliver extremely crisp images as the pixels per inch or PPI increased from 99 to 144. Together with a nice and bright backlit screen, the Micro almost creates the illusion of being able to play GBA games at High Definition image quality. Oh, and the headphone jack returned. 

Is this the one Game Boy system to rule them all? That depends on whether or not backwards compatibility is high on your priority list, as Nintendo decided, for the very first time in their handheld division, to drop support for older Game Boy cartridges. It might not come to a big surprise considering the physical size of the machine. A small portion of the 8-bit Sharp CPU is still present since GBA games could make use of its 4-channel APU.

\begin{figure*}[ht!]
    \centering
    \includegraphics[width=0.9\columnwidth]{ch-handheld-gba/gbconsolesizes.png}
    \caption{A comparison of Game Boy device sizes (actual size). Dimensions in millimeter.}
\end{figure*}


### The Game Boy Advance CPU Architecture

\begin{figure}[h!]
    \centering
    \includegraphics{ch-handheld-gba/gba-architecture.png}
    \caption{A simplified schematic of the Game Boy Advance hardware architecture. Memory components are marked in orange (BIOS ROMs not depicted). Components are connected with a hybrid 8-bit (GBC ROM, SRAM) Based on Rodrigo Copetti's Game Boy Diagram.}
\end{figure}

arch dinges enzo bla

### Processing Instructions

Plus, a "bit" about the speed of the CPU; hier ook nodig?

### Game Boy Advance Accessories

acc dinges enzo bla

